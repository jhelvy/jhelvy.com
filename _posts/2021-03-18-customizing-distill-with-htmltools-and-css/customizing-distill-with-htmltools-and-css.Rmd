---
title: "Customizing distill with {htmltools} and CSS"
description: |
  How I added lots of little features to my distill site with custom functions, the {htmltools} package, and CSS.
author: John Paul Helveston
date: 03-18-2021
output:
  distill::distill_article:
    self_contained: false
    toc: true
draft: true
---

One of the things I love about [{distill}](https://rstudio.github.io/distill/) as a site builder is that it is super light weight. It comes out of the box with very few bells and whistles, enabling you to create a site from scratch in minutes. This is the number one reason I chose distill over [{blogdown}](https://bookdown.org/yihui/blogdown/) to build my site. I tried for days to customize the [Hugo Academic theme](https://themes.gohugo.io/academic/) to create the site I had in mind with blogdown, but I found the overall configuration a bit overwhelming, even with the guidance of Alison Hill's incredible [post](https://alison.rbind.io/post/new-year-new-blogdown/) on how to do it (btw, if you want to make a blogdown site, you totally should read her [posts on blogdown](https://alison.rbind.io/categories/blogdown/)).

That said, once I did get my distill site running, I found myself longing for some of the really cool features I've seen on peoples' blogdown sites, like how to make masonry cards like [these](https://alison.rbind.io/projects/) (if you can't tell yet, [Alison Hill's site](https://alison.rbind.io/) was a major source of inspiration for me). But then I realized I'm working in R, and whenever I want some functionality that doesn't yet exist, I just write my own function! 

So that's what I set out to do - write a bunch of functions to construct the features I wanted. This post walks through the general strategy and then shows how I implemented each custom feature on my site. 

# Finding the html 

For every feature I wanted to add, my starting point was trying to find an example somewhere of the raw html for that feature. My knowledge of html is very limited and hacky, but I do know that if I see something I want, I can use the "inspect" tool in Chrome to grab the html by right-clicking on it and selecting "Copy element", like this: 

<center>
<img src="images/inspect.gif" width=100%>
</center>

With some html in hand, I had a template to work with. My starting point was to just drop in the html directly to a page and edit it until it looked the way I wanted. Then I had to find a way to _generate_ that html on the fly. 

But how to write R code to create html code...?

# [{htmltools}](https://unleash-shiny.rinterface.com/htmltools-overview.html) to the rescue!

Luckily, some [clever folks](https://unleash-shiny.rinterface.com/references.html#ref-R-htmltools) wrote a package that generates html code! Since html controls formatting by wrapping content inside tags, the {htmltools} package uses a bunch of handy functions to generate those tags for you. For example, if I wanted to make a level 1 header tag, I could use the `h1()` function:

```{r htmltools_div}
library(htmltools)

content <- h1("Hello World")
print(content)
```

For most situations, this works great, but there are also times where I need a tag that isn't yet supported. In those case, you can insert the tags yourself as a string and use the `tag()` function to create custom tags. For example, the `<aside>` tag is used in distill to put content in the sidebar, but {htmltools} does not have an `aside()` function. Instead, I can create those tages like this:

```{r htmltools_raw}
content <- tag("aside", "Hello World")
print(content)
```

> Note: I knew essentially **none** of this when I started this just a few weeks ago, for fortunately the [{htmltools} documentation](https://unleash-shiny.rinterface.com/htmltools-overview.html) is really, really good!

With this in mind, we now have just about everything we need to start writing functions to construct some html! I'll start with a simple example of writing a function to insert some text in the sidebar.

# Haiku research summaries

Inspired by [Andrew Heiss's research page](https://www.andrewheiss.com/research/), I wanted to insert a haiku summary next to each citation of each paper on my [publications page](https://jhelvy.github.io/publications.html). All you need to do is wrap some text in `<aside>` tags and it will show up in the side bar. But rather than write the html for each haiku (e.g. `<aside>haiku text</aside>`), I decided to write a simple function to generate the html tags for me. 

I started with three functions to generate the tags for some center-aligned text in the sidebar:

```{r}
# Generates <aside>text</aside>
aside <- function(text) {
  return(htmltools::tag("aside", list(text)))
}

# Generates <center>text</center>
center <- function(text) {
  return(htmltools::tag("center", list(text)))
}

# Generates <aside><center>text</center></aside>
aside_center <- function(text) {
  return(aside(center(list(text))))
}
```

Now I can insert some center-aligned text in the sidebar with the function `aside_center(text)`. But since haikus have a particular 5-7-5 syllabic structure, I thought it would be better to put each line on a separate row. I also wanted the haikus to be in italic font. So I wrote a `haiku()` function that takes three text inputs and generates the html to put them in the side bar on separate lines:

```{r}
haiku <- function(one, two, three) {
  return(aside_center(list(
    htmltools::em(
      one, htmltools::br(), 
      two, htmltools::br(), 
      three)
  )))
}
```

With this little function, I can insert haikus throughout my publications page without having to write any html! For example, the html for the haiku for our recent [paper](https://doi.org/10.1088/1748-9326/aba715) in _Environmental Research Letters_ is generated like this:

```{r}
html <- haiku("A five minute ride", "In an EV can increase", "the chance you'll buy one")

print(html)
```

> **Important caveat**: For this to work, I had to insert each haiku using in-line R code, like this: `` `r knitr::inline_expr('haiku("one", "two", "three")')` ``. If I used a code chunk, the output will get wrapped in a `<div>`, nullifying the `<aside>` tags.

Hopefully this example gives you the gist of the general strategy of writing a function to produce the desired html. For the remaining features on this post, I won't spend as much time walking through the details, but I will show the functions I wrote (and accompanying CSS code when necessary) to generate different features.

# Icon links

# Google Scholar stats

# "Last updated on..." statement in footer

# Float image left layout

# "Masonry" cards
